<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Ballsy Bet</title>
    <link rel="icon" type="image/png" href="misc/icons8-feather-55.png">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #000066;
        }

        .game-container {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.33);
            text-align: center;
            width: 90%;
            max-width: 500px;
        }
        
        .payouts-table {
            max-width: 300px;
            width: 100%;
            border-collapse: collapse;
            margin: 20px auto;
            font-size: 14px;
        }
        
        .payouts-table th, .payouts-table td {
            border: 1px solid #ddd;
            padding: 8px;
        }

        .payouts-table th {
            background-color: #f2f2f2;
            color: #333;
        }

        .ball-display {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            min-height: 80px;
        }

        .ball {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-weight: bold;
            font-size: 50px;
            transition: background-color 0.5s ease;
            border: 2px solid #aaa;
        }

        .ball.yellow { background-color: #FFD700; border-color: #E5C100; }
        .ball.red { background-color: #FF4500; border-color: #E53E00; }
        .ball.black { background-color: #333; border-color: #000; }

        .controls-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-box {
            background-color: #eee;
            padding: 10px 20px;
            border-radius: 5px;
            text-align: center;
        }

        .stat-box p {
            margin: 0 0 5px 0;
            font-size: 14px;
            color: #666;
        }

        .stat-box span {
            font-size: 24px;
            font-weight: bold;
        }

        .message-area {
            margin: 20px 0;
            min-height: 40px;
        }

        #message {
            font-size: 18px;
            color: #555;
            font-weight: bold;
        }

        #play-button {
            padding: 24px 24px;
            font-size: 18px;
            color: #fff;
            background-color: #007BFF;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #play-button:hover {
            background-color: #0056b3;
        }

        #play-button:disabled {
            background-color: #aaa;
            cursor: not-allowed;
        }

    </style>
</head>
<body>

    <div class="game-container">
        <table class="payouts-table">
            <thead>
                <tr>
                    <th>Winning Combos</th>
                    <th>Payouts</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>All Different Colors</td>
                    <td>$50</td>
                </tr>
                <tr>
                    <td>Three Blacks</td>
                    <td>$100</td>
                </tr>
                <tr>
                    <td>Three Yellows</td>
                    <td>$150</td>
                </tr>
                <tr>
                    <td>Three Reds</td>
                    <td>$200</td>
                </tr>
            </tbody>
        </table>

        <div class="ball-display">
            <div id="ball1" class="ball">?</div>
            <div id="ball2" class="ball">?</div>
            <div id="ball3" class="ball">?</div>
        </div>

        <div class="message-area">
            <p id="message">Win $1000 to complete the game!</p>
        </div>
        
        <div class="controls-area">
            <div class="stat-box">
                <p>Your Money</p>
                <span id="player-coins"></span>
            </div>
            <button id="play-button">Draw ($10)</button>
            <div class="stat-box">
                <p>House Bank</p>
                <span id="house-coins"></span>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const playerCoinsDisplay = document.getElementById('player-coins');
            const houseCoinsDisplay = document.getElementById('house-coins');
            const playButton = document.getElementById('play-button');
            const messageDisplay = document.getElementById('message');
            const balls = [
                document.getElementById('ball1'),
                document.getElementById('ball2'),
                document.getElementById('ball3')
            ];

            let playerCoins = 50;
            let houseCoins = 950;
            const costToPlay = 10;
            // The new maxPlayerCoins is the sum of the initial player and house money
            const maxPlayerCoins = playerCoins + houseCoins; 

            const ballBag = [];
            // Ball distribution: 10 of each color
            for (let i = 0; i < 10; i++) {
                ballBag.push('black');
                ballBag.push('yellow');
                ballBag.push('red');
            }

            function updateStatsDisplay() {
                // This function now only updates the UI, it does not check for game-over.
                playerCoinsDisplay.textContent = `$${playerCoins}`;
                houseCoinsDisplay.textContent = `$${houseCoins}`;
            }

            function checkGameOver() {
                // This function now handles the game over logic.
                if (playerCoins < costToPlay) {
                    messageDisplay.textContent = "Game Over! You've run out of money!";
                    playButton.textContent = "Restart Game";
                    playButton.disabled = true;
                    // Delay for 3 seconds before enabling restart button
                    setTimeout(() => {
                        playButton.disabled = false;
                    }, 3000);
                } else if (houseCoins <= 0) {
                    messageDisplay.textContent = "Congratulations! You've won the game!";
                    playButton.textContent = "Restart Game";
                    playButton.disabled = true;
                    // Delay for 3 seconds before enabling restart button
                    setTimeout(() => {
                        playButton.disabled = false;
                    }, 3000);
                }
            }

            function resetGame() {
                playerCoins = 50;
                houseCoins = 950;
                resetBallDisplay();
                updateStatsDisplay();
                playButton.textContent = "Draw ($10)";
                playButton.disabled = false;
                messageDisplay.textContent = `Win $${maxPlayerCoins} to complete the game!`;
            }

            function resetBallDisplay() {
                balls.forEach(ball => {
                    ball.textContent = '?';
                    ball.className = 'ball';
                });
            }

            function drawBalls() {
                const shuffledBag = [...ballBag].sort(() => 0.5 - Math.random());
                const drawnBalls = [
                    shuffledBag.pop(),
                    shuffledBag.pop(),
                    shuffledBag.pop()
                ];
                return drawnBalls;
            }

            function checkResult(drawnBalls) {
                const counts = { 'yellow': 0, 'red': 0, 'black': 0 };
                drawnBalls.forEach(color => {
                    counts[color]++;
                });

                const uniqueColors = Object.values(counts).filter(count => count > 0).length;
                let payout = 0;
                let resultText = "";

                if (uniqueColors === 3) {
                    payout = 50;
                    resultText = "All different colors! You win $50.";
                } else if (counts['black'] === 3) {
                    payout = 100;
                    resultText = "Three Blacks! You win $100.";
                } else if (counts['yellow'] === 3) {
                    payout = 150;
                    resultText = "Three Yellows! You win $150.";
                } else if (counts['red'] === 3) {
                    payout = 200;
                    resultText = "Three Reds! You win $200.";
                } else {
                    resultText = "Better luck next time!";
                }

                return { payout, resultText };
            }

            function playGame() {
                resetBallDisplay();
                
                // The cost of the spin is deducted and the display is updated immediately.
                playerCoins -= costToPlay;
                houseCoins += costToPlay;
                updateStatsDisplay();

                playButton.disabled = true;
                messageDisplay.textContent = "Drawing one, two, three...";

                const drawnBalls = drawBalls();

                setTimeout(() => {
                    balls[0].textContent = '';
                    balls[0].className = `ball ${drawnBalls[0]}`;
                }, 1000);

                setTimeout(() => {
                    balls[1].textContent = '';
                    balls[1].className = `ball ${drawnBalls[1]}`;
                }, 2250);

                setTimeout(() => {
                    balls[2].textContent = '';
                    balls[2].className = `ball ${drawnBalls[2]}`;
                    
                    const { payout, resultText } = checkResult(drawnBalls);

                    if (payout > 0) {
                        const oldPlayerCoins = playerCoins;
                        playerCoins = Math.min(playerCoins + payout, maxPlayerCoins);
                        const actualWinnings = playerCoins - oldPlayerCoins;
                        // The house's money will not fall below 0
                        houseCoins = Math.max(0, houseCoins - actualWinnings);

                        if (actualWinnings < payout) {
                            messageDisplay.textContent = `${resultText} (Winnings capped at $${maxPlayerCoins})`;
                        } else {
                            messageDisplay.textContent = resultText;
                        }
                    } else {
                        messageDisplay.textContent = resultText;
                    }

                    updateStatsDisplay(); // Update the display with the final result
                    checkGameOver(); // Check for game over conditions after everything is settled
                    
                    // Shorter delay to re-enable button on a losing spin
                    const reEnableDelay = (payout > 0) ? 2000 : 500;
                    if (playButton.textContent !== "Restart Game") {
                      setTimeout(() => {
                        playButton.disabled = false;
                      }, reEnableDelay);
                    }

                }, 3500);
            }

            playButton.addEventListener('click', () => {
                if (playButton.textContent === "Restart Game") {
                    resetGame();
                } else {
                    playGame();
                }
            });

            updateStatsDisplay();
        });
    </script>
</body>
</html>
