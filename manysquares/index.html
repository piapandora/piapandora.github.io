<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>160x90 Grid - Blue Palette</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;width:100%;background:#000;display:flex;align-items:center;justify-content:center;overflow:hidden;}
  #grid{
    display:grid;
    width:calc(min(100vw / 160, 100vh / 90) * 160);
    height:calc(min(100vw / 160, 100vh / 90) * 90);
    grid-template-columns:repeat(160,1fr);
    grid-template-rows:repeat(90,1fr);
    gap:0;
  }
  .cell{width:100%;height:100%;}

  .c-0 { background: #1a1a4d; }   /* darkest blue */
  .c-1 { background: #1a1a4d; }
  .c-2 { background: #2a2a66; }   /* slightly lighter */
  .c-3 { background: #3b3b80; }
  .c-4 { background: #5555a0; }
  .c-5 { background: #7070b8; }
  .c-6 { background: #8c8cd0; }
  .c-7 { background: #a8a8e6; }
  .c-8 { background: #ccccff; }
  .c-9 { background: #ccccff; }   /* lightest blue */
</style>
</head>
<body>

<div id="grid"></div>

<script>
const COLS = 160;
const ROWS = 90;
const TOTAL = COLS * ROWS;
const grid = document.getElementById('grid');

function brightnessToIndex(r,g,b){
  const bright = (r+g+b)/3;   // 0-255
  const step = Math.floor(bright / 26);  // 256/10 â‰ˆ 25.6
  return Math.min(step,9);     // clamp 0-9
}

function drawImage(imageArray){
  grid.innerHTML='';
  const frag = document.createDocumentFragment();
  for(let i=0;i<TOTAL;i++){
    const div = document.createElement('div');
    div.className='cell c-'+imageArray[i];
    frag.appendChild(div);
  }
  grid.appendChild(frag);
}

function processImage(img){
  const canvas = document.createElement('canvas');
  canvas.width = COLS;
  canvas.height = ROWS;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(img,0,0,COLS,ROWS);
  const data = ctx.getImageData(0,0,COLS,ROWS).data;
  let arr = [];
  for(let i=0;i<data.length;i+=4){
    arr.push(brightnessToIndex(data[i],data[i+1],data[i+2]));
  }
  return arr;
}

async function copyToClipboard(text){
  try { await navigator.clipboard.writeText(text); console.log('JSON copied!'); }
  catch(e){ console.warn('Clipboard copy failed:', e); }
}

function handleImage(file){
  const reader = new FileReader();
  reader.onload = e=>{
    const img = new Image();
    img.onload = async ()=>{
      const arr = processImage(img);
      drawImage(arr);
      await copyToClipboard(JSON.stringify({ data: arr.join('') }));
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

function handleJSON(file){
  const reader = new FileReader();
  reader.onload = e=>{
    try{
      const json = JSON.parse(e.target.result);
      if(json.data && json.data.length===TOTAL){
        const arr = Array.from(json.data).map(c=>parseInt(c));
        drawImage(arr);
        copyToClipboard(JSON.stringify({ data: arr.join('') }));
      } else { console.warn('Invalid JSON'); }
    } catch(err){ console.warn('Failed to parse JSON',err); }
  };
  reader.readAsText(file);
}

function handleFile(file){
  const supportedTypes = [
    'image/png','image/jpeg','image/jpg',
    'image/bmp','image/webp','image/gif','image/avif'
  ];
  if(supportedTypes.includes(file.type)) handleImage(file);
  else if(file.type==='application/json') handleJSON(file);
  else console.warn('Unsupported file type:', file.type);
}

// Drag-and-drop anywhere
window.addEventListener('dragover',e=>e.preventDefault());
window.addEventListener('drop',e=>{
  e.preventDefault();
  if(e.dataTransfer.files.length>0) handleFile(e.dataTransfer.files[0]);
});
</script>

</body>
</html>
