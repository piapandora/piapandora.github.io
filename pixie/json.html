<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pixie JSON Viewer</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box}
  html,body{
    height:100%;width:100%;
    display:flex;align-items:center;justify-content:center;
    background:#000;
  }
  #grid{display:grid;gap:0}
  .cell{width:100%;height:100%}
  .c-0 { background:#1a1a4d }
  .c-1 { background:#1a1a4d }
  .c-2 { background:#2a2a66 }
  .c-3 { background:#3b3b80 }
  .c-4 { background:#5555a0 }
  .c-5 { background:#7070b8 }
  .c-6 { background:#8c8cd0 }
  .c-7 { background:#a8a8e6 }
  .c-8 { background:#ccccff }
  .c-9 { background:#ccccff }
</style>
</head>
<body>

<div id="grid"></div>

<script>
const MAX_COLS=160, MAX_ROWS=90, grid=document.getElementById('grid');

function padTo160x90(arr,nativeCols,nativeRows){
  const full=Array(MAX_COLS*MAX_ROWS).fill(0);
  const offX=Math.floor((MAX_COLS-nativeCols)/2);
  const offY=Math.floor((MAX_ROWS-nativeRows)/2);
  for(let y=0;y<nativeRows;y++){
    for(let x=0;x<nativeCols;x++){
      full[(y+offY)*MAX_COLS+(x+offX)]=arr[y*nativeCols+x];
    }
  }
  return full;
}

function drawImage(arr){
  grid.innerHTML='';
  grid.style.gridTemplateColumns=`repeat(${MAX_COLS},1fr)`;
  grid.style.gridTemplateRows=`repeat(${MAX_ROWS},1fr)`;
  grid.style.width=`calc(min(100vw / ${MAX_COLS}, 100vh / ${MAX_ROWS}) * ${MAX_COLS})`;
  grid.style.height=`calc(min(100vw / ${MAX_COLS}, 100vh / ${MAX_ROWS}) * ${MAX_ROWS})`;
  const frag=document.createDocumentFragment();
  arr.forEach(v=>{
    const d=document.createElement('div');
    d.className='cell c-'+v;
    frag.appendChild(d);
  });
  grid.appendChild(frag);
}

function handleJSON(file){
  const reader=new FileReader();
  reader.onload=e=>{
    try{
      const j=JSON.parse(e.target.result);
      const raw=Array.from(j.data).map(c=>parseInt(c));
      let cols=Math.round(Math.sqrt(raw.length*MAX_COLS/MAX_ROWS));
      let rows=Math.round(raw.length/cols);
      const full=padTo160x90(raw,cols,rows);
      drawImage(full);
    }catch(err){console.warn("Invalid JSON",err);}
  };
  reader.readAsText(file);
}

window.addEventListener('dragover',e=>e.preventDefault());
window.addEventListener('drop',e=>{
  e.preventDefault();
  if(e.dataTransfer.files.length){
    const f=e.dataTransfer.files[0];
    if(f.type==='application/json') handleJSON(f);
  }
});
</script>
</body>
</html>
