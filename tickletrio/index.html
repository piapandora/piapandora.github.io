<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Tickle Trio</title>
    <link rel="icon" type="image/png" href="misc/icons8-feather-55.png">
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            background-color: #3C3C3C;
            user-select: none;
        }

        .menu-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            height: 60px;
            background-color: #1F2020;
            color: #eee;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        #game-title {
            font-size: 20px;
            font-weight: bold;
            white-space: nowrap;
            cursor: pointer;
        }
        
        .payouts-header {
            display: flex;
            justify-content: space-around;
            width: 100%;
            font-size: 18px;
            font-weight: bold;
            color: #ffff00;
        }

        .payouts-header .payout-amount {
            color: #eee;
        }

        .menu-btn {
            width: 32px;
            height: 32px;
            cursor: pointer;
        }

        main {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 150px); 
            box-sizing: border-box;
        }
        
        .portrait-display {
            display: flex;
            justify-content: center;
            gap: 35px;
            margin: 0;
            min-height: 300px;
        }
        
        .portrait {
            width: 360px;
            border-radius: 15px;
            border: 10px solid rgba(0, 0, 0, 1);
            object-fit: cover;
            opacity: 1;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            /* Use a CSS custom property for the transition duration */
            transition: opacity var(--fade-duration, 1s) ease-in-out;
        }
        
        .controls-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 0;
        }

        .stat-box {
            background-color: #1F2020;
            padding: 10px 20px;
            border-radius: 5px;
            text-align: center;
            color: #eee;
        }

        .stat-box p {
            margin: 0 0 5px 0;
            font-size: 14px;
            color: #aaa;
        }

        .stat-box span {
            font-size: 24px;
            font-weight: bold;
            color: #ffff00;
        }
        
        #message {
            font-size: 18px;
            color: #eee;
            font-weight: bold;
            transition: opacity 0.5s ease-in-out;
            opacity: 0; /* Initially hidden for the fade-in effect on load */
        }

        #play-button {
            padding: 24px 24px;
            font-size: 1rem;
            font-weight: bold;
            color: #dddddd;
            background-color: #1F2020;
            border: 2px solid #555;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        #play-button:hover {
            background-color: #333;
            color: #ffff00;
        }
        
        #play-button:disabled {
            background-color: #333;
            color: #999;
            cursor: not-allowed;
            border-color: #555;
        }

        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 90px;
            background-color: #1F2020;
            color: #eee;
            display: grid;
            grid-template-columns: 1fr 1fr;
            align-items: center;
            padding: 0 15px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.5);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .fadeIn {
            animation: fadeIn 1s ease-in-out forwards;
        }
    </style>
</head>
<body>

    <div class="menu-bar">
        <span id="game-title">The Tickle Trio</span>
        <div class="payouts-header">
            <span>All Different <span class="payout-amount">$50</span></span>
            <span>All Dark <span class="payout-amount">$100</span></span>
            <span>All Blonde <span class="payout-amount">$150</span></span>
            <span>All Red <span class="payout-amount">$200</span></span>
        </div>
        <img src="misc/icons8-fullscreen-32.png" class="menu-btn" id="full-btn" alt="Fullscreen">
    </div>

    <main>
        <div class="portrait-display">
            <img id="portrait1" class="portrait" src="misc/card-back.png" alt="Portrait 1">
            <img id="portrait2" class="portrait" src="misc/card-back.png" alt="Portrait 2">
            <img id="portrait3" class="portrait" src="misc/card-back.png" alt="Portrait 3">
        </div>
    </main>
    
    <div class="footer">
        <div id="message-area">
            <p id="message">Win $1000 to complete the game!</p>
        </div>
        <div class="controls-area">
            <div class="stat-box">
                <p>Your Money</p>
                <span id="player-coins"></span>
            </div>
            <button id="play-button">Tickle ($10)</button>
            <div class="stat-box">
                <p>House Bank</p>
                <span id="house-coins"></span>
            </div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const playerCoinsDisplay = document.getElementById('player-coins');
        const houseCoinsDisplay = document.getElementById('house-coins');
        const playButton = document.getElementById('play-button');
        const messageDisplay = document.getElementById('message');
        const portraits = [
            document.getElementById('portrait1'),
            document.getElementById('portrait2'),
            document.getElementById('portrait3')
        ];
        
        const fullBtn = document.getElementById('full-btn');
        const gameTitle = document.getElementById('game-title');


        let playerCoins = 50;
        let houseCoins = 950;
        const costToPlay = 10;
        const maxPlayerCoins = playerCoins + houseCoins;
        
        // Variables to hold the timer IDs so we can cancel them
        let messageTimer1, messageTimer2;
        let portraitTimer1, portraitTimer2, portraitTimer3;
        let resultTimer;


        // This object maps hair color categories to arrays of image filenames.
		const portraitPool = {
			'dark': [
				'dark01.jpg', 'dark02.jpg', 'dark03.jpg', 'dark04.jpg', 'dark05.jpg',
				'dark06.jpg', 'dark07.jpg', 'dark08.jpg', 'dark09.jpg', 'dark10.jpg'
			],
			'blonde': [
				'blonde01.jpg', 'blonde02.jpg', 'blonde03.jpg', 'blonde04.jpg', 'blonde05.jpg',
				'blonde06.jpg', 'blonde07.jpg', 'blonde08.jpg', 'blonde09.jpg', 'blonde10.jpg'
			],
			'red': [
				'red01.jpg', 'red02.jpg', 'red03.jpg', 'red04.jpg', 'red05.jpg',
				'red06.jpg', 'red07.jpg', 'red08.jpg', 'red09.jpg', 'red10.jpg'
			]
		};

        // A helper function to shuffle an array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // A helper function to get the hair color from the image path
        function getHairColorFromPath(path) {
            // Extracts the hair color from the path, e.g., "images/dark/dark1.jpg" -> "dark"
            return path.split('/')[1];
        }

        function updateStatsDisplay() {
            playerCoinsDisplay.textContent = `$${playerCoins}`;
            houseCoinsDisplay.textContent = `$${houseCoins}`;
        }

        function checkGameOver() {
            if (playerCoins < costToPlay) {
                messageDisplay.textContent = "Game Over! You've run out of money!";
                playButton.textContent = "Restart Game";
                playButton.disabled = true;
                setTimeout(() => { playButton.disabled = false; }, 3000);
            } else if (houseCoins <= 0) {
                messageDisplay.textContent = "Congratulations! You've won the game!";
                playButton.textContent = "Restart Game";
                playButton.disabled = true;
                setTimeout(() => { playButton.disabled = false; }, 3000);
            }
        }
        
        // This function will clear any pending timers to stop animations.
        function clearAllTimers() {
            clearTimeout(messageTimer1);
            clearTimeout(messageTimer2);
            clearTimeout(portraitTimer1);
            clearTimeout(portraitTimer2);
            clearTimeout(portraitTimer3);
            clearTimeout(resultTimer);
        }

        function resetGame() {
            clearAllTimers();

            playerCoins = 50;
            houseCoins = 950;
            
            // Set the custom property for a quick fade-out
            portraits.forEach(p => p.style.setProperty('--fade-duration', '0.5s'));
            
            // Clear the images and make them fade out
            portraits.forEach(portrait => {
                portrait.style.opacity = '0';
            });
            setTimeout(() => {
                // Reset the custom property for the standard fade-in
                portraits.forEach(p => p.style.setProperty('--fade-duration', '1s'));
                portraits.forEach(portrait => {
                    portrait.src = 'misc/card-back.png';
                    portrait.style.opacity = '1';
                });
            }, 500);

            updateStatsDisplay();
            playButton.textContent = "Tickle ($10)";
            playButton.disabled = false;
            
            // Fade out the current message.
            messageDisplay.style.opacity = '0';
            
            // Wait for the fade-out to complete (0.5s) before fading in the new message.
            setTimeout(() => {
                messageDisplay.textContent = `Win $${maxPlayerCoins} to complete the game!`;
                messageDisplay.style.opacity = '1';
            }, 500);
        }

        // This is the drawing function that guarantees unique portraits
        function drawUniquePortraits() {
            const allPortraits = [];
            // Create a flat array of all image paths
            for (const color in portraitPool) {
                portraitPool[color].forEach(file => {
                    allPortraits.push(`images/${color}/${file}`);
                });
            }
            // Shuffle the array and pick the first three for the round
            shuffleArray(allPortraits);
            return allPortraits.slice(0, 3);
        }

        function checkResult(drawnPortraitPaths) {
            const counts = { 'dark': 0, 'blonde': 0, 'red': 0 };
            drawnPortraitPaths.forEach(path => {
                const color = getHairColorFromPath(path);
                counts[color]++;
            });

            const uniqueColors = Object.values(counts).filter(count => count > 0).length;
            let payout = 0;
            let resultText = "";

            if (uniqueColors === 3) {
                payout = 50;
                resultText = "All different hair colors - You win $50!";
            } else if (counts['dark'] === 3) {
                payout = 100;
                resultText = "Three dark-haired beauties - You win $100!";
            } else if (counts['blonde'] === 3) {
                payout = 150;
                resultText = "Three blonde beauties - You win $150!";
            } else if (counts['red'] === 3) {
                payout = 200;
                resultText = "Three red-haired beauties - You win $200!";
            } else {
                resultText = "Better luck next time!";
            }

            return { payout, resultText };
        }

        function playGame() {
            playerCoins -= costToPlay;
            houseCoins += costToPlay;
            updateStatsDisplay();

            playButton.disabled = true;
            
            // Fade out the previous message
            messageDisplay.style.opacity = '0';
            
            // First, fade out all current portraits
            portraits.forEach(p => p.style.setProperty('--fade-duration', '0.5s'));
            portraits.forEach(portrait => {
                portrait.style.opacity = '0';
            });
            
            // After the old message fades out, change the text and fade in "Tickling..."
			messageDisplay.textContent = "Tickling...";
			messageDisplay.style.opacity = '1';
			
			// After 1 second, fade out the "Tickling..." message
			messageTimer2 = setTimeout(() => {
				messageDisplay.style.opacity = '0';
			}, 2800);

            // Start the staggered fade-in of new portraits after both message transitions
            portraitTimer1 = setTimeout(() => {
                // Reset the custom property for the standard fade-in of portraits
                portraits.forEach(p => p.style.setProperty('--fade-duration', '1s'));

                const drawnPortraitPaths = drawUniquePortraits();

                // Draw the first portrait
                portraitTimer1 = setTimeout(() => {
                    portraits[0].src = drawnPortraitPaths[0];
                    portraits[0].style.opacity = '1';
                }, 300);

                // Draw the second portrait
                portraitTimer2 = setTimeout(() => {
                    portraits[1].src = drawnPortraitPaths[1];
                    portraits[1].style.opacity = '1';
                }, 1300);

                // Draw the third portrait and check result
                portraitTimer3 = setTimeout(() => {
                    portraits[2].src = drawnPortraitPaths[2];
                    portraits[2].style.opacity = '1';
                    
                    const { payout, resultText } = checkResult(drawnPortraitPaths);
                    
                    // Delay the result message by 500ms after the last portrait appears
                    resultTimer = setTimeout(() => {
                        if (payout > 0) {
                            playerCoins = Math.min(playerCoins + payout, maxPlayerCoins);
                            houseCoins = Math.max(0, houseCoins - payout);
                            messageDisplay.textContent = resultText;
                        } else {
                            messageDisplay.textContent = resultText;
                        }
                        updateStatsDisplay();
                        checkGameOver();
                        
                        // This is where we fade in the result message by setting opacity to 1
                        messageDisplay.style.opacity = '1';
                        
                        const reEnableDelay = (payout > 0) ? 1000 : 500;
                        if (playButton.textContent !== "Restart Game") {
                            setTimeout(() => { playButton.disabled = false; }, reEnableDelay);
                        }
                    }, 500);
                }, 2300);
            }, 500); // This delay is the sum of all message transitions (0.5s + 0.5s + 1s + 0.5s)
        }

        playButton.addEventListener('click', () => {
            if (playButton.textContent === "Restart Game") {
                resetGame();
            } else {
                playGame();
            }
        });

        // Add event listener for the game title to reset the game
        gameTitle.addEventListener('click', resetGame);

        // Add event listener for the fullscreen button
        fullBtn.addEventListener('click', () => {
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                document.documentElement.requestFullscreen();
            }
        });

        // Add event listeners for hover effect on the fullscreen button
        fullBtn.addEventListener('mouseenter', function() {
            this.src = "misc/icons8-fullscreen-yellow-32.png";
        });
        fullBtn.addEventListener('mouseleave', function() {
            this.src = "misc/icons8-fullscreen-32.png";
        });

        updateStatsDisplay();
        
        // This is the code for the initial fade-in of the "Win..." message
        setTimeout(() => {
            messageDisplay.style.opacity = '1';
        }, 1);
        
        // Show the initial portraits and borders when the page loads
        portraits.forEach(portrait => {
            portrait.style.opacity = '1';
        });
    });
</script>
</body>
</html>