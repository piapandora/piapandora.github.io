<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Triadic Inspiration</title>
    <link rel="icon" type="image/png" href="misc/icons8-fibonacci-circles-50.png">
    <style>
        body, html { 
            margin: 0; padding: 0; 
            width: 100%; height: 100%; 
            background: #000; 
            overflow: hidden; 
            display: flex; align-items: center; justify-content: center;
            touch-action: manipulation; 
        }
        canvas { 
            width: 100vw; height: 100vh; 
            object-fit: contain; 
            image-rendering: pixelated; 
        }
    </style>
</head>
<body>
<canvas id="canvas"></canvas>
<script>
const COLS = 160, ROWS = 90;
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = COLS; canvas.height = ROWS;

const PALETTE_LIBRARY = [
    // --- 01-10: THE ORIGINALS (REFINED TRIADIC) ---
    ["#FF8C42", "#FF3C38", "#052F5F"], ["#E3B448", "#3A6351", "#A7333F"],
    ["#4B0082", "#ADFF2F", "#00CED1"], ["#1B3022", "#ECAC32", "#392F5A"],
    ["#E68A3F", "#4FA36F", "#6A4FA3"], ["#9B59B6", "#1ABC9C", "#F1C40F"],
    ["#FF6B6B", "#4ECDC4", "#1A535C"], ["#2C3E50", "#E74C3C", "#27AE60"],
    ["#2D5A27", "#F39C12", "#C0392B"], ["#FF00FF", "#00FFFF", "#FFFF00"],
    // --- 11-20: ACCENTED ANALOGOUS ---
    ["#2B2D42", "#8D99AE", "#EF233C"], ["#006466", "#065A60", "#D00000"],
    ["#240046", "#3C096C", "#FF9100"], ["#1A759F", "#1E6091", "#F7B267"],
    ["#386641", "#6A994E", "#BC4749"], ["#432818", "#99582A", "#00A8E8"],
    ["#FF0054", "#FF5400", "#00FFCC"], ["#22223B", "#4A4E69", "#F2E9E4"],
    ["#7B2CBF", "#9D4EDD", "#CCFF33"], ["#003566", "#001D3D", "#FFC300"],
    // --- 21-30: NOIR & NEON ---
    ["#0D0221", "#240B36", "#C31432"], ["#0F0F0F", "#2C2C2C", "#FFD700"],
    ["#000000", "#152238", "#00F2FF"], ["#081200", "#1B2E00", "#7FFF00"],
    ["#120000", "#310000", "#FF4500"], ["#1A1A1D", "#4E4E50", "#6F2232"],
    ["#191919", "#2D4263", "#C84B31"], ["#000000", "#393E46", "#00ADB5"],
    ["#101820", "#423F3E", "#F2AA4C"], ["#0B0C10", "#1F2833", "#66FCF1"],
    // --- 31-40: THE MASTERS ---
    ["#1A1A1A", "#8B4513", "#D4AF37"], ["#2F4F4F", "#708090", "#FFDAB9"],
    ["#003366", "#E1AD01", "#FFFFFF"], ["#556B2F", "#BDB76B", "#FF6347"],
    ["#000000", "#FFFFFF", "#FF0000"], ["#4B0082", "#9400D3", "#00FF7F"],
    ["#2E0854", "#FF007F", "#00E5EE"], ["#3D2B1F", "#63472C", "#C0C0C0"],
    ["#191970", "#000080", "#E6E6FA"], ["#800000", "#DAA520", "#F0E68C"],
    // --- 41-50: BIOMIMICRY ---
    ["#000B18", "#002B5B", "#00EAFF"], ["#2D5A27", "#61892F", "#86C232"],
    ["#3E2723", "#5D4037", "#FFEB3B"], ["#012030", "#13678A", "#9AEBA3"],
    ["#1E1E26", "#4D4D5A", "#FF0055"], ["#0B3D91", "#FC3D21", "#FFFFFF"],
    ["#212529", "#343A40", "#E9ECEF"], ["#513B56", "#525B76", "#BCE7FD"],
    ["#3C1518", "#69140E", "#D58936"], ["#004B23", "#007200", "#CCFF33"],
    // --- 51-60: MONOCHROMATIC + PUNCH ---
    ["#000000", "#111111", "#FFFFFF"], ["#1A1A1A", "#333333", "#FF0000"],
    ["#03045E", "#023E8A", "#00B4D8"], ["#2D00F7", "#6A00F4", "#F20089"],
    ["#10002B", "#3C096C", "#9D4EDD"], ["#004B23", "#008000", "#38B000"],
    ["#3D0000", "#950101", "#FF0000"], ["#252422", "#403D39", "#EB5E28"],
    ["#220901", "#621708", "#941B0C"], ["#001219", "#005F73", "#94D2BD"],
    // --- 61-70: TETRADIC ---
    ["#001219", "#EE9B00", "#AE2012"], ["#264653", "#2A9D8F", "#E9C46A"],
    ["#606C38", "#283618", "#DDA15E"], ["#F94144", "#F3722C", "#90BE6D"],
    ["#277DA1", "#577590", "#F9C74F"], ["#540D6E", "#EE4266", "#FFD23F"],
    ["#312244", "#4E148C", "#FFC857"], ["#003049", "#D62828", "#F77F00"],
    ["#1D3557", "#457B9D", "#E63946"], ["#4A4E69", "#9A8C98", "#C9ADA7"],
    // --- 71-80: VAPORWAVE & RETRO ---
    ["#FF71CE", "#01CDFE", "#05FFA1"], ["#B967FF", "#FFFB96", "#05FFA1"],
    ["#7209B7", "#3F37C9", "#4CC9F0"], ["#120458", "#FF00A0", "#00FFD1"],
    ["#2D1B33", "#5C2B66", "#D1A3FF"], ["#1B1B1B", "#00FF41", "#008F11"],
    ["#FB8500", "#FFB703", "#219EBC"], ["#EF476F", "#FFD166", "#06D6A0"],
    ["#264653", "#E76F51", "#E9C46A"], ["#6D597A", "#B56576", "#E56B6F"],
    // --- 81-90: SUBTRACTIVE ---
    ["#00FFFF", "#FF00FF", "#FFFF00"], ["#FF0000", "#FFFF00", "#0000FF"],
    ["#2B2D42", "#D90429", "#8D99AE"], ["#011627", "#FD4D3D", "#2EC4B6"],
    ["#000814", "#001D3D", "#FFC300"], ["#232123", "#F9F9F9", "#FF0055"],
    ["#1A1C20", "#F0DB4F", "#323330"], ["#46211A", "#693D3D", "#BA5536"],
    ["#141A35", "#243B4A", "#EBC944"], ["#000000", "#FF0000", "#FFFFFF"],
    // --- 91-100: EXPERIMENTAL ---
    ["#0D1B2A", "#415A77", "#E0E1DD"], ["#355070", "#6D5978", "#E56B6F"],
    ["#222222", "#444444", "#888888"], ["#FFF100", "#FF0059", "#000000"],
    ["#10002B", "#240046", "#FF00FF"], ["#2A9134", "#134E19", "#FFD700"],
    ["#14213D", "#000000", "#FCA311"], ["#3D348B", "#7678ED", "#F7B801"],
    ["#242423", "#333533", "#CFDBD5"], ["#000000", "#303030", "#FFFB00"]
];

let seeds = [];
let currentPalette = [];
let targetPalette = [];
let lastPaletteIndex = -1;
let lerpFactor = 0;
let isPaused = false;
let holdTimer = 0;
const HOLD_DURATION = 266; 

let lastTime = 0;
const TARGET_FPS = 60;

function hexToRgb(hex) {
    const r = parseInt(hex.slice(1, 3), 16);
    const g = parseInt(hex.slice(3, 5), 16);
    const b = parseInt(hex.slice(5, 7), 16);
    return {r, g, b};
}

function getNewPaletteIndex() {
    let nextIndex;
    do {
        nextIndex = Math.floor(Math.random() * PALETTE_LIBRARY.length);
    } while (nextIndex === lastPaletteIndex);
    return nextIndex;
}

function init() {
    lastPaletteIndex = getNewPaletteIndex();
    const p = PALETTE_LIBRARY[lastPaletteIndex];
    currentPalette = p.map(hexToRgb);
    targetPalette = [...currentPalette];
    
    for (let i = 0; i < 80; i++) {
        let type = 0;
        const r = Math.random();
        if (r > 0.6 && r <= 0.9) type = 1;
        else if (r > 0.9) type = 2;
        
        seeds.push({
            x: Math.random() * COLS,
            y: Math.random() * ROWS,
            vx: (Math.random() - 0.5) * 0.12,
            vy: (Math.random() - 0.5) * 0.12,
            type: type,
            strength: 0.7 + Math.random() * 0.6
        });
    }
    requestAnimationFrame(animate);
}

function updateColors(dtM) {
    if (lerpFactor < 1) {
        lerpFactor += 0.01 * dtM; 
    } else if (!isPaused) {
        holdTimer += dtM;
        if (holdTimer > HOLD_DURATION) {
            holdTimer = 0;
            lerpFactor = 0;
            currentPalette = [...targetPalette];
            lastPaletteIndex = getNewPaletteIndex();
            const next = PALETTE_LIBRARY[lastPaletteIndex];
            targetPalette = next.map(hexToRgb);
        }
    }
}

function animate(currentTime) {
    if (!lastTime) {
        lastTime = currentTime;
        requestAnimationFrame(animate);
        return;
    }
    let elapsed = currentTime - lastTime;
    if (elapsed > 100) elapsed = 16.67; 
    lastTime = currentTime;
    const dtM = elapsed / (1000 / TARGET_FPS);

    updateColors(dtM);
    
    if (!isPaused) {
        for (let s of seeds) {
            s.x += s.vx * dtM; 
            s.y += s.vy * dtM;
            if (s.x < 0) { s.x = 0; s.vx *= -1; }
            if (s.x > COLS) { s.x = COLS; s.vx *= -1; }
            if (s.y < 0) { s.y = 0; s.vy *= -1; }
            if (s.y > ROWS) { s.y = ROWS; s.vy *= -1; }
        }
    }

    const imgData = ctx.createImageData(COLS, ROWS);
    const activeColors = [0, 1, 2].map(t => ({
        r: currentPalette[t].r + (targetPalette[t].r - currentPalette[t].r) * Math.min(lerpFactor, 1),
        g: currentPalette[t].g + (targetPalette[t].g - currentPalette[t].g) * Math.min(lerpFactor, 1),
        b: currentPalette[t].b + (targetPalette[t].b - currentPalette[t].b) * Math.min(lerpFactor, 1)
    }));

    for (let y = 0; y < ROWS; y++) {
        for (let x = 0; x < COLS; x++) {
            let minDist = Infinity;
            let closestType = 0;
            for (const s of seeds) {
                const dist = ((x - s.x) ** 2 + (y - s.y) ** 2) * s.strength;
                if (dist < minDist) { minDist = dist; closestType = s.type; }
            }
            const idx = (y * COLS + x) * 4;
            const color = activeColors[closestType];
            imgData.data[idx] = color.r;
            imgData.data[idx+1] = color.g;
            imgData.data[idx+2] = color.b;
            imgData.data[idx+3] = 255;
        }
    }
    ctx.putImageData(imgData, 0, 0);
    requestAnimationFrame(animate);
}

window.addEventListener("dblclick", () => {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(() => {});
    } else {
        document.exitFullscreen();
    }
});

window.addEventListener("keydown", (e) => {
    if (e.code === "Space") {
        isPaused = !isPaused; 
    } else if (e.code === "Enter" || e.code === "NumpadEnter") {
        const offscreen = document.createElement('canvas');
        offscreen.width = 1920; offscreen.height = 1080;
        const oCtx = offscreen.getContext('2d');
        oCtx.imageSmoothingEnabled = false;
        oCtx.drawImage(canvas, 0, 0, 1920, 1080);
        const link = document.createElement('a');
        link.download = `triadic-${Date.now()}.png`;
        link.href = offscreen.toDataURL("image/png");
        link.click();
    }
});

init();
</script>
</body>
</html>